---
categories: [中间件]
tags: [分布式,定时任务，任务调度]
---

# xxl-job

参考[官方指引](https://www.xuxueli.com/xxl-job/#1.5%20下载)

![xxl-job架构图](../assets/2025-08-12-xxl-job/structure.png)

## 基本概念

### 调度中心（Scheduler Center）

**核心职责**：

1. **任务调度中枢**：通过自研调度引擎（2.1.0版本后移除Quartz依赖，采用时间轮算法）触发任务，支持Cron表达式、固定间隔、API事件等多种触发策略。
2. **集群高可用**：支持多节点部署，通过MySQL悲观锁（`SELECT ... FOR UPDATE`）实现分布式锁，避免集群环境下重复调度。
3. **动态管理**：提供Web界面实时操作任务（启停/修改/终止），配置路由策略（轮询、故障转移、分片广播等），并监控任务进度与日志。
4. **持久化存储**：依赖MySQL管理任务元数据（`xxl_job_info`）、执行日志（`xxl_job_log`）、执行器注册信息（`xxl_job_registry`）等。

**关键设计**：

- 调度与执行解耦：调度中心仅发起HTTP请求，不承担业务逻辑，确保轻量化和扩展性。

### 执行器（Executor）

**核心角色**：

1. **任务执行单元**：集成于业务应用（如Spring Boot项目），通过`@XxlJob`注解定义任务处理器（JobHandler），接收调度中心的HTTP调用并执行业务代码。
2. **集群化部署**：支持动态注册与发现，通过心跳机制（每30秒上报）维护执行器存活状态，调度中心自动感知集群变化。
3. **资源隔离**：多任务使用独立线程池，避免任务雪崩；支持任务超时控制、失败重试及日志实时上报。

**交互流程**：

- 执行器启动后向调度中心注册地址（如`http://192.168.1.10:9999`），调度中心根据路由策略选择目标执行器发起任务请求。

### 任务（Job）

**最小调度单元**：

1. **任务类型**：
   - **Bean模式**：业务代码直接嵌入执行器项目，通过注解声明处理器。
   - **GLUE模式**：脚本任务（Shell/Python等）动态维护在调度中心，支持热更新。
2. **分片机制**：大数据任务可拆分为分片（如`shardIndex/shardTotal`），由不同执行器并行处理，显著提升吞吐量。

## 常见使用方式